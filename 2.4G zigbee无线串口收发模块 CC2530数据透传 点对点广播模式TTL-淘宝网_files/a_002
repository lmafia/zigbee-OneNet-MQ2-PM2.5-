KISSY.add("tbc/search-suggest/1.4.7/suggest",function(e,t){function r(e){r.superclass.constructor.call(this,e||{})}return r=t.extend({initializer:function(){var e=this;e.on("afterRenderData",function(){e.fire("beforeShow")})},sendRequest:function(e){var t=this,r=t.constructor.superclass.sendRequest;if(t.fire("beforeQueryChange",{query:e})===!1)return!1;t.queryTimer&&clearTimeout(t.queryTimer),t.laterTimer&&clearTimeout(t.laterTimer);var n=arguments;t.queryTimer=setTimeout(function(){t.queryTimer=null,t.laterTimer=setTimeout(function(){t.later=!1},500),r.apply(t,n)},t.later?200:50),t.later=!0},handleKeyDownInternal:function(e){var t=this,r=t.constructor.superclass.handleKeyDownInternal;return t.fire("beforeKeyDown",{event:e})===!1?!1:void r.apply(this,arguments)},handleKeyEventInternal:function(e){var t=this,r=t.constructor.superclass.handleKeyEventInternal;return t.fire("beforeKeyDown",{event:e})===!1?!1:void r.apply(this,arguments)},setValueInternal:function(e){var t=this,r=t.constructor.superclass.setValueInternal;return t.fire("beforeSetInputValue",{event:e})===!1?!1:void r.apply(this,arguments)},setValueFromAutocomplete:function(e){var t=this,r=t.constructor.superclass.setValueFromAutocomplete;return t.fire("beforeSetInputValue",{event:e})===!1?!1:void r.apply(this,arguments)},renderItems:function(t,r,n){var a,u,o=this,s=o.get("sugConfig").resultFormat,i=o.resultArr||(o.resultArr=[]),l="",c=t;e.each(r,function(t,o){if(!t||!t[0])return void r.splice(o,1);for(a=t[0];a.indexOf(c)<0;)c=c.substr(0,c.length-1);""===c?(l=a,a=""):0===a.indexOf(c)&&(l=c,a=a.replace(c,""));for(var f in i)if(u=i[f],u.textContent===t[0]&&u.unique)return;n=n.replace("{format}",s),i.push({textContent:t[0],content:e.substitute(n,{query:l,text:a,index:o+1,count:t[1]}),list:!0})}),o.resultArr=i},alignInternal:function(e){var t=this,r=t.constructor.superclass.alignInternal;return t.fire("beforeShow",{event:e})===!1?!1:void r.apply(this,arguments)}},{ATTRS:{dataSourceCfg:{value:{xhrCfg:{url:"",dataType:"jsonp",scriptCharset:"utf-8",data:{code:"utf-8"}},allowEmpty:!0,paramName:"q",cache:!0}},mods:{value:{},setter:function(e){return e}}}}),r.RemoteDataSource=t.RemoteDataSource,r.LocalDataSource=t.LocalDataSource,r},{requires:["combobox"]});KISSY.add("tbc/search-suggest/1.4.7/mods/mods",function(){return{"new":{tmpl:'<div class="item-wrapper {prefixCls}menu-extras-xp" data-key="q={$queryUrl}&suggest=new_{$index}&tab=shopping&auction_tag[]=1154"><span class="{prefixCls}menu-xp-tag">新品</span><span class="{prefixCls}menu-xp-icon">新品</span><span class="{prefixCls}menu-xp">“{$query}”相关{new}新品</span></div>'},shop:{tmpl:'<div class="item-wrapper {prefixCls}menu-extras-dp" data-action="//shopsearch.taobao.com/search" data-key="q={$queryUrl}&suggest=shop_{$index}"><span class="{prefixCls}menu-dp">{$query} <b>相关店铺</b></span><span class="{prefixCls}menu-dp-icon">店铺</span></div>'},cat:{tmpl:'<div class="{prefixCls}menu-extras-cate" data-key="q={$2}&cat={$1}&suggest=cat_{$index}"><span class="{prefixCls}menu-key">{$2}</span><span class="{prefixCls}menu-cate">在<b>{$0}</b>分类下搜索</span></div>'},list:{tmpl:"<div data-index='{index}' class='item-wrapper' data-key='q={textContent}&suggest=0_{index}'><span class='item-text'>{query}<b>{text}</b></span><span class='item-count'>{format}</span></div>"},global:{tmpl:'<div class="{prefixCls}menu-extras-cate" data-key="q={$queryUrl}&promote=2097152&suggest=global_{$index}"><span class="{prefixCls}menu-key">{$query}</span><span class="{prefixCls}menu-cate">在全球购市场中搜索</span></div>'},history:{tmpl:'<div class="{prefixCls}menu-extras-history" {attr} data-key="q={historyItemQuery}&suggest={extraParam}_{index}" data-index="_his_{index}" data-value="{historyItemValue}"><span class="{prefixCls}menu-history-key">{historyItemValue}</span><span data-type="{extraParam}" class="{prefixCls}menu-history-delete">删除</span></div>'},scene:{tmpl:'<div class="{prefixCls}menu-extras-cate extras-scene" data-action="//fa.taobao.com/search" data-key="q={scene}&suggest=scene_{$index}"><span class="{prefixCls}menu-key">{scene}</span><b>装修宝典/选购秘籍</b></div>'},dapei_bottom:{tmpl:'<div class="item-wrapper {prefixCls}menu-extras-dp" data-source-stat="source_click=suggest_kfc&source_pv=suggest_kfc#!Content" data-action="//pose.taobao.com/search" data-key="q={dapei_bottom}"><span class="{prefixCls}menu-dp">{dapei_bottom}<b>全套搭配</b></span></div>'},dapei_top:{tmpl:'<div class="{prefixCls}menu-extras-cate" data-source-stat="source_click=suggest_jqc&source_pv=suggest_jqc#!Content" data-action="//pose.taobao.com/search" data-key="q={dapei_top}"><span class="{prefixCls}menu-key">{dapei_top}</span><span class="{prefixCls}menu-cate">在<b>搭配</b>下搜索</span></div>'},tmall:{tmpl:'<div class="{prefixCls}menu-extras-cate extras-mall" data-key="q={tmall}&suggest=tmall_{$index}&tab=mall"><span class="{prefixCls}menu-key">{tmall}</span><b>天猫相关</b></div>'},c2c_activity:{tmpl:'<div class="{prefixCls}menu-extras-cate extras-active" data-key="q={c2c_activity_query} {c2c_activity_tag}&suggest=active_{$index}&tab=deal"><span class="{prefixCls}menu-key">{c2c_activity_query}</span><span class="{prefixCls}menu-cate">在 <b>{c2c_activity_tag}</b> 中搜索</span></div>'},showExtra:!1}});KISSY.add("tbc/search-suggest/1.4.7/mods/bts",function(t,e,u){function n(t){n.superclass.constructor.call(this,t||{})}return t.extend(n,e,{getBucket:function(){var t=this,e=t.getCookieT(),u=t.getTestBucket()||t.retBucket(e,20,-4,4)-0;return u},getTestBucket:function(){var t=location.search,e=t.match(/alg_bts=(\d+)/);return e&&e[1]?e[1]-0:void 0},getCookieT:function(){var t=new u,e=t.getCookie("t");return e},retBucket:function(t,e,u,n){return!t&&"0"||this.countBucket(t,e,u,n)},countBucket:function(t,e,u,n){var r=t.substr(u,n),c=parseInt(r,16),s=c%e+1;return s+""}},{ATTRS:{pluginId:{value:"bts"}}}),n},{requires:["base","./utils"]});KISSY.add("tbc/search-suggest/1.4.7/mods/utils",function(e,t){function n(e){return i?i:(n.superclass.constructor.call(this,e||{}),void(i=this))}var i;return e.extend(n,t,{pluginInitializer:function(e){var t=this;t.set("caller",e)},getCookie:function(t){var n=window;if(n.userCookie&&!e.isUndefined(n.userCookie[t]))return n.userCookie[t];if(n.SRP_COOKIES||(n.SRP_COOKIES={})&&e.isUndefined(SRP_COOKIES[t])){var i=document.cookie.match("(?:^|;)\\s*"+t+"=([^;]*)");SRP_COOKIES[t]=i&&i[1]?decodeURIComponent(i[1]):""}return SRP_COOKIES[t]},fireEvent:function(e,t){var n=document;if(n.createEvent){var i=n.createEvent("MouseEvents");i.initEvent(t,!0,!1),e.dispatchEvent(i)}else n.createEventObject&&e.fireEvent("on"+t)}},{ATTRS:{pluginId:{value:"utils"}}}),n},{requires:["base"]});KISSY.add("tbc/search-suggest/1.4.7/mods/stat",function(t,e,n,a,i){function r(t){r.superclass.constructor.call(this,t||{})}return t.extend(r,e,{pluginInitializer:function(t){var e=this,n=e.get("stat");e.set("caller",t),t.on("beforeSubmit",function(t){var n=t.isInitSearch;e.setStat(n)}),n&&(e.sendTongji(),e.bindSearchTrace())},bindSearchTrace:function(){var t=this;a.delegate("body","click","a",t.initSearchTrace,t)},initSearchTrace:function(t){var e=this,n=t.currentTarget,a=n.getAttribute("trace"),i=n.getAttribute("href");if(a)switch(a){case"relatedSearch":e.saveQuery();break;case"auction":var r=e.stat;r&&-1===i.indexOf("initiative_new")&&n.setAttribute("href",i+"&initiative_new=1")}},sendTongji:function(){var t,e=this,n=e.getStatInst();n.checkFlash({onSuccess:function(){t=n.query("stat")[0],t&&t.value&&(e.stat=t.value,e.send("f_stats_show="+t.value,!0))}})},setStat:function(t,e){var n=this,a=n.get("caller"),i=a.query,r=n.saveQuery(i,t);r&&n.send("lf_aclog=null-null-null-null-0&stats_click="+r,e)},getStatInst:function(){var t=this,e=t.get("caller"),n=e.get("sugConfig"),a=n.tab||"",r=new i({name:"stat",tab:a});return r},saveQuery:function(t,e){var n,a,i=this.getStatInst();return e&&t?(n=encodeURIComponent(t),a="initiative_new:1;q:"+n,i.save("stat",a)):i.deleteItem("stat"),a},send:function(t,e){var n,a;e?(n="/tongji",a="H51884970"):(n="/search",a="H51884969"),(window.goldlog_queue||(window.goldlog_queue=[])).push({action:"goldlog.record",arguments:[n,"",t,a]})},renderPlugin:function(){}},{ATTRS:{pluginId:{value:"stat"}}}),r},{requires:["base","cookie","event","../mods/local-query"]});